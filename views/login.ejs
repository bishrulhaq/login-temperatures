<!DOCTYPE html>
<html lang="en">
<head>
    <%- include("./partials/header.ejs") %>
</head>

<body id="body">
<%- include("./partials/nav.ejs") %>s

<div id="server" class="container">
    <div class="row justify-content-md-center mt-5">
        <div class="col-sm-6">
            <h2>Login</h2>

            <form class="needs-validation" method="post" @submit.prevent="signIn">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" class="form-control" v-model="username" name="username">
                    <div v-if="errors.username != ''" class="invalid">
                        Username Cannot Be Empty
                    </div>

                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" class="form-control" v-model="password" name="password">
                    <div v-if="errors.password.required != ''" class="invalid">
                        <span>Password Cannot Be Empty</span>
                    </div>
                    <div v-if="errors.password.char != ''" class="invalid">
                        <span>Password must be 6 to 10 Characters Long</span>
                    </div>
                </div>

                <button type="submit" class="btn btn-succcess btn-lg">Login</button>
            </form>

            <hr>

            <p>Need an account <a href="/register">Register</a></p>
            <p>Go Back <a href="/">Home</a>.</p>
        </div>
    </div>
</div>
<%- include("./partials/footer.ejs") %>
<script>

    let server = new Vue({
        el: '#server',
        data: {
            errors: {
                username: '',
                password: {
                    required: '',
                    char: ''
                }
            },
            username: '',
            password: '',
        },
        methods: {
            nullCheck: function (value, field) {
                if (value == null || value == '') {
                    return field + " cannot be empty";
                }
                return '';
            },
            charLong: function (value, field, from, to) {
                if (value.length < from || value.length > to) {
                    return field + " should be six to 10 characters long";
                }
                return '';
            },
            passwordMatch: function (password, confirmPassword) {
                if (password != confirmPassword) {
                    return "Confirm Password is not the same";
                }
                return '';
            },
            signIn: function () {

                this.errors.username = this.nullCheck(this.username, 'username');
                this.errors.password.required = this.nullCheck(this.password, 'password');
                if (!this.errors.password.required) {
                    this.errors.password.char = this.charLong(this.password, 'password', 6, 10);
                }

                const validate = (this.errors.username || this.errors.password.required || this.errors.password.char) === '';

                if (validate === true) {
                    $.ajax({
                        url: `${window.location.origin}/login`,
                        method: "POST",
                        dataType: 'json',
                        data: {username: this.username, password: this.password},
                        success: function (data) {
                            window.location.href = "/";
                        },
                        error: function (err) {

                        }
                    })
                }


            }
        }
    })
</script>
</body>
</html>